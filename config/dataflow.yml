# Dora-MoveIt: Mini Motion Planning Framework
# ============================================
#
# This dataflow implements a MoveIt-like motion planning pipeline:
#
# Architecture:
#   demo_node (UI) 
#       → planning_scene (scene manager)
#           → planner (OMPL motion planning)
#               → ik_op (inverse kinematics)
#           → collision_check (collision queries)
#
# Data Flow:
#   1. demo_node sends planning goals
#   2. planning_scene manages world state
#   3. planner generates collision-free trajectories
#   4. ik_op converts poses to joint configurations
#   5. collision_check validates configurations

nodes:
  # ===========================================
  # Planning Scene Manager (Central Coordinator)
  # ===========================================
  # Like MoveIt's PlanningScene - single source of truth
  - id: planning_scene
    path: planning_scene_op.py
    inputs:
      robot_state: demo/robot_state
      scene_command: demo/scene_command
      tick: dora/timer/millis/5000  # Periodic scene broadcast
    outputs:
      - scene_update      # Broadcasted to all operators
      - command_result    # Response to commands

  # ===========================================
  # OMPL Motion Planner
  # ===========================================
  # RRT/RRT-Connect planner with embedded collision checking
  - id: planner
    path: planner_ompl_with_collision_op.py
    inputs:
      plan_request: demo/plan_request
      scene_update: planning_scene/scene_update
    outputs:
      - trajectory     # Planned path (list of joint configs)
      - plan_status    # Planning result

  # ===========================================
  # Inverse Kinematics Solver
  # ===========================================
  # Converts end-effector pose to joint positions
  - id: ik_solver
    path: ik_op.py
    inputs:
      ik_request: demo/ik_request
      joint_state: demo/robot_state
    outputs:
      - ik_solution    # Joint positions
      - ik_status      # IK result status

  # ===========================================
  # Collision Checker
  # ===========================================
  # Validates configurations for collision
  - id: collision_checker
    path: collision_check_op.py
    inputs:
      check_request: demo/collision_check
      scene_update: planning_scene/scene_update
    outputs:
      - collision_result  # Collision check result
      - scene_info        # Current scene info

  # ===========================================
  # Demo/Test Node
  # ===========================================
  # Interactive demo that tests all components
  - id: demo
    path: demo_node.py
    inputs:
      tick: dora/timer/millis/2000  # Demo update rate
      trajectory: planner/trajectory
      plan_status: planner/plan_status
      ik_solution: ik_solver/ik_solution
      ik_status: ik_solver/ik_status
      collision_result: collision_checker/collision_result
      scene_update: planning_scene/scene_update
      command_result: planning_scene/command_result
    outputs:
      - robot_state       # Current robot joint positions
      - plan_request      # Motion planning request
      - ik_request        # IK request
      - collision_check   # Collision check request
      - scene_command     # Scene modification commands

